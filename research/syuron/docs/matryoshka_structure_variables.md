# マトリョーシカ型QPM構造の変数定義

## 構造概要

マトリョーシカ型QPM構造は、異なる周期を持つ複数のセクションを位相整合層で連結した階層構造です。

### 階層構造
1. **デバイス全体**: 複数のセクションと位相整合層
2. **セクション**: 特定周期の領域（複数のセグメントと位相調整層）
3. **セグメント**: 一定周期（κ正負ドメイン2つで1周期）の分極反転構造
4. **ドメイン**: κの正負が定義される最小単位

## 変数定義

### デバイス全体レベル

| 変数 | 定義 | 説明 |
|------|------|------|
| $z$ | 伝搬軸座標 | 光の伝搬方向（縦型QPMデバイスの軸） |
| $z_0$ | デバイス開始位置 | 通常は $z_0 = 0$ |
| $z_N$ | デバイス終端位置 | デバイス全長 |
| $L_{total}$ | デバイス全長 | $L_{total} = z_N - z_0$ |
| $N_{sec}$ | セクション数 | デバイス内のセクション総数 |
| $N_{PM}$ | 位相整合層数 | セクション間の位相整合層数（通常 $N_{PM} = N_{sec} - 1$） |

### セクションレベル

| 変数 | 定義 | 説明 |
|------|------|------|
| $i$ | セクションインデックス | $i = 1, 2, \ldots, N_{sec}$ |
| $\Lambda_i$ | セクション$i$の周期 | セクション$i$内で一定の分極反転周期 |
| $L_i$ | セクション$i$の長さ | セクション$i$の物理的長さ |
| $z_{i,start}$ | セクション$i$開始位置 | セクション$i$の開始座標 |
| $z_{i,end}$ | セクション$i$終端位置 | セクション$i$の終端座標 |
| $N_{seg,i}$ | セクション$i$内のセグメント数 | セクション$i$に含まれるセグメント数 |
| $N_{PA,i}$ | セクション$i$内の位相調整層数 | セクション$i$内の位相調整層数（通常 $N_{PA,i} = N_{seg,i} - 1$） |

### 位相整合層（セクション間）

| 変数 | 定義 | 説明 |
|------|------|------|
| $PM_j$ | 位相整合層$j$ | セクション$j$と$j+1$の間の位相整合層 |
| $L_{PM,j}$ | 位相整合層$j$の長さ | 位相整合層$j$の物理的長さ |
| $\kappa_{PM,j}$ | 位相整合層$j$の非線形係数 | 通常は $\kappa_{PM,j} = \kappa$ (一定) |

### セグメントレベル

| 変数 | 定義 | 説明 |
|------|------|------|
| $j$ | セグメントインデックス | セクション$i$内で $j = 1, 2, \ldots, N_{seg,i}$ |
| $S_{i,j}$ | セクション$i$のセグメント$j$ | セクション$i$内の$j$番目のセグメント |
| $L_{S,i,j}$ | セグメント$(i,j)$の長さ | セグメント$S_{i,j}$の物理的長さ |
| $N_{dom,i,j}$ | セグメント$(i,j)$内のドメイン数 | セグメント$S_{i,j}$に含まれるドメイン数 |

### 位相調整層（セグメント間）

| 変数 | 定義 | 説明 |
|------|------|------|
| $PA_{i,k}$ | 位相調整層$(i,k)$ | セクション$i$内のセグメント$k$と$k+1$の間の位相調整層 |
| $L_{PA,i,k}$ | 位相調整層$(i,k)$の長さ | 位相調整層$PA_{i,k}$の物理的長さ |
| $\kappa_{PA,i,k}$ | 位相調整層$(i,k)$の非線形係数 | 通常は $\kappa_{PA,i,k} = \kappa$ (一定) |

### ドメインレベル

| 変数 | 定義 | 説明 |
|------|------|------|
| $k$ | ドメインインデックス | セグメント内で $k = 1, 2, \ldots, N_{dom,i,j}$ |
| $L_{dom}$ | ドメイン長 | 1つのドメインの長さ（通常は $L_{dom} = \Lambda_i / 2$） |
| $\kappa^+$ | 正の非線形係数 | 正方向の分極を持つドメインの非線形係数 |
| $\kappa^-$ | 負の非線形係数 | 負方向の分極を持つドメインの非線形係数（$\kappa^- = -\kappa^+$） |
| $\kappa$ | 非線形係数の大きさ | $|\kappa^+| = |\kappa^-| = \kappa$ |

### 物理パラメータ

| 変数 | 定義 | 説明 |
|------|------|------|
| $A_\omega(z)$ | 基本波振幅 | 位置$z$での基本波の複素振幅 |
| $A_{2\omega}(z)$ | 第二高調波振幅 | 位置$z$での第二高調波の複素振幅 |
| $A_{in}$ | 入力基本波振幅 | デバイス入力端での基本波振幅 |
| $\beta^\omega$ | 基本波伝搬定数 | 基本波の位相定数 |
| $\beta^{2\omega}$ | 第二高調波伝搬定数 | 第二高調波の位相定数 |
| $\Gamma$ | 位相不整合 | $2\Gamma = \beta^{2\omega} - 2\beta^\omega$ |
| $\Gamma_i'$ | セクション$i$の実効位相不整合 | $2\Gamma_i' = \beta^{2\omega} - 2\beta^\omega - \frac{2\pi}{\Lambda_i}$ |
| $K_i$ | セクション$i$の格子ベクトル | $K_i = \frac{2\pi}{\Lambda_i}$ |

## 設計パラメータ

### セクション周期の関係

各セクションの周期$\Lambda_i$は位相整合波長をずらすように設計されます：

$$\Lambda_i = \frac{2\pi}{\Delta\beta_i + \delta_i}$$

ここで：
- $\Delta\beta_i$: セクション$i$の目標位相不整合
- $\delta_i$: セクション間の波長シフト量

### 長さ比の設計指針

先行研究に基づく設計例：
- **2セグメント構成**: $L_1 : L_2 = 0.165 : 0.835$
- **3セグメント構成**: 各セグメント間に最適化された位相調整層

### マトリョーシカ構造の特徴

1. **階層的位相整合**: セクションレベルとセグメントレベルの二重位相整合
2. **周期多様性**: $\Lambda_1 \neq \Lambda_2 \neq \Lambda_3 \neq \ldots$
3. **κ統一性**: 全てのドメインで $|\kappa| = $ 一定
4. **スケーラビリティ**: セクション数$N_{sec}$は任意に拡張可能

## 数式表現

### 各セクションでのSHG振幅

セクション$i$での第二高調波振幅は：

$$A_{2\omega,i}(z) = \sum_{j=1}^{N_{seg,i}} A_{2\omega,i,j}^{(seg)} + \sum_{k=1}^{N_{PA,i}} A_{2\omega,i,k}^{(PA)}$$

### 全体でのSHG振幅

デバイス全体での出力振幅は：

$$A_{2\omega,total} = \sum_{i=1}^{N_{sec}} A_{2\omega,i} + \sum_{j=1}^{N_{PM}} A_{2\omega,j}^{(PM)}$$

ここで各項は適切な位相因子を含む必要があります。

## 実装時の注意点

1. **インデックスの一貫性**: $(i,j,k)$の階層的インデックス管理
2. **位置座標の計算**: 累積長さによる位置決定
3. **位相の連続性**: セクション・セグメント境界での位相接続
4. **最適化パラメータ**: 各層の長さと周期の同時最適化